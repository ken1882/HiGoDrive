<!DOCTYPE html>
<html lang="zh-TW" dir="ltr">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>HiGoDrive</title>

  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js">
    </script>
    <![endif]-->

  <!--CSS-->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <link rel="stylesheet" href="css/style.css">

  <!--JS-->
  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
    integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
    crossorigin="anonymous"></script>

  <!--ICON-->
  <script src="https://kit.fontawesome.com/9b78fa3fff.js" crossorigin="anonymous"></script>
</head>

<body>

  <div class="container">
    <div class="m-4 p-2">
      <h2 class="text-center">HiGoDrive</h2>
      <br>
      <img id="motor" class="rounded mx-auto d-block" src="/assets/motorcycle-solid.svg" type="image/svg+xml" />
      <hr>
    </div>

    <div class="accordion" id="accordion">

      <template id="template-report">
        <div class="card">
          <div class="card-header" id="headingReport">
            <button id="reportBtn" class="btn btn-block" data-toggle="collapse" data-target="#collapseReport"
              aria-expanded="false" aria-controls="collapseReport">
              <div class="row">
                <div class="col-5">
                  <span>用戶：</span><span id="repoterIdTitle" class="text-primary text-left"></span>
                </div>
                <div class="col-5">
                  <span name="type" class="text-warning">申訴處理</span>
                </div>
                <div class="col-2">
                  <i class="fas fa-sort-down fa-lg"></i>
                </div>
              </div>
            </button>
          </div>
          <div id="collapseReport" class="collapse" aria-labelledby="headingReport" data-parent="#accordion">
            <div class="card-body">
              <span>訂單簡介</span>
              <ul>
                <li>目的地：<span id="placeName"></span></li>
                <!--<li>路程：<span id=""></span></li>-->
                <li>費用：<span id="fare"></span></li>
              </ul>
              <p><span>駕駛名稱：</span><span id="driverName"></span></p>
              <p><span>乘客名稱：</span><span id="passengerName"></span></p>
              <p id="report_content">申訴說明：<span id="reportComment"></span></p>
              <br>
              <button type="button" class="btn btn-success btn-block">申訴處理完成</button>
            </div>
          </div>
        </div>
      </template>

      <template id="template-license">
        <div class="card">
          <div class="card-header" id="headingLicense">
            <button id="licenseBtn" class="btn btn-block" data-toggle="collapse" data-target="#collapseLicense"
              aria-expanded="false" aria-controls="collapseLicense">
              <div class="row">
                <div class="col-5">
                  <span name="id" class="text-primary text-left">用戶：58586</span>
                </div>
                <div class="col-5">
                  <span name="type" class="text-warning">司機資格審核</span>
                </div>
                <div class="col-2">
                  <i class="fas fa-sort-down fa-lg"></i>
                </div>
              </div>
            </button>
          </div>
          <div id="collapseLicense" class="collapse" aria-labelledby="headingLicense" data-parent="#accordion">
            <div class="card-body">
              <p>
                駕照正面照片
                <img id="driver_license" alt="駕照正面照片">
              </p>
              <p>
                行照正片照片
                <img id="vehicle_license" alt="行照正片照片">
              </p>
              <p>
                車身照片
                <img id="exterior" alt="車身照片">
              </p>
              <p>車牌：<span id="palte"></span></p>
              <p>車型：<span id="module"></span></p>
              <br>
              <div class="row">
                <div class="col">
                  <button type="button" class="btn btn-danger btn-block">不通過</button>
                </div>
                <div class="col">
                  <button type="button" class="btn btn-success btn-block">通過</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </template>

    </div>
  </div>

  <script type="text/javascript">
    function renderReport(report) {
      let card = $("#template-report").clone();

      let taskId = report.task_id;
      let reportedTask = getTask(taskId);
      let reporterIdplaceName = reportedTask.dest.placeName;
      let fare = reportedTask.dest.fare;
      let driverName = reportedTask.driver_name;
      let passengerName = reportedTask.author_name;

      let reporterId = report.author_id;
      let reportComment = report.comment;
      let reportTime = report.created_at;

      card.find("#headingReport").attr("id", "headingReport" + taskId);
      card.find("#reportBtn").attr("data-target", "#" + "collapseReport" + taskId);
      card.find("#reportBtn").attr("aria-controls", "collapseReport" + taskId);
      card.find("#reportBtn").attr("id", "reportBtn" + taskId);
      card.find("#headingReport").text(reporterId);
      card.find("#headingReport").attr("id", "headingReport" + taskId);
      card.find("#collapseReport").attr("aria-labelledby", "headingReport" + taskId);
      card.find("#collapseReport").attr("id", "collapseReport" + taskId);
      card.find("#placeName").text(placeName);
      card.find("#placeName").attr("id", "placeName" + taskId);
      card.find("#fare").text(fare);
      card.find("#fare").attr("id", "fare" + taskId);
      card.find("#driverName").text(driverName);
      card.find("#driverName").attr("id", "driverName" + taskId);
      card.find("#passengerName").text(passengerName);
      card.find("#passengerName").attr("id", "passengerName" + taskId);
      card.find("#reportComment").text(reportComment);
      card.find("#reportComment").attr("id", "reportComment" + taskId);

      $("#accordion").append(card);
    }

    function renderLicenses(report) {
      let card = $("#template-license").clone();

      let taskId;
      let applyId;
      let driver_licenseImg;
      let vehicle_licenseImg;
      let exteriorImg;
      let palteText;
      let moduleText;

      card.find("#headingLicense").attr("id", "headingLicense" + taskId);
      card.find("#licenseBtn").attr("data-target", "#" + "collapseLicense" + taskId);
      card.find("#licenseBtn").attr("aria-controls", "collapseLicense" + taskId);
      card.find("#licenseBtn").attr("id", "licenseBtn" + taskId);
      card.find("#headingLicense").text(applyId);
      card.find("#headingLicense").attr("id", "headingLicense" + taskId);
      card.find("#collapseLicense").attr("aria-labelledby", "headingLicense" + taskId);
      card.find("#collapseLicense").attr("id", "collapseLicense" + taskId);
      card.find("#driver_license").attr("src", driver_licenseImg);
      card.find("#driver_license").attr("id", "driver_license" + taskId);
      card.find("#vehicle_license").attr("src", vehicle_licenseImg);
      card.find("#vehicle_license").attr("id", "vehicle_license" + taskId);
      card.find("#exterior").attr("src", exteriorImg);
      card.find("#exterior").attr("id", "exterior" + taskId);
      card.find("#palte").text(palteText);
      card.find("#palte").attr("id", "palte" + taskId);
      card.find("#module").text(moduleext);
      card.find("#module").attr("id", "palte" + taskId);

      $("#accordion").append(card);
    }

    $(document).ready(function () {
      let reportList = getReportList();
      reportList.forEach(report => {
        renderReport(report);
      });

      let licensesList = getUnprocessedLicenses();
      licensesList.forEach(licenses => {
        renderLicenses(licenses);
      });
    });

    $('.collapse').collapse()
  </script>
</body>

</html>